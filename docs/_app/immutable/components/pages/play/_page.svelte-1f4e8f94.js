import{S as N,i as D,s as I,k as g,l as d,m as k,h,n as w,b as L,H as T,Q as y,j as z,a1 as b,ag as F,W as K,Y as R,Z as X,_ as x,f as O,t as Y,a as P,v as C,c as S,w as J,x as U,y as B,o as ee,q as $,r as H,L as _,M as te,u as se,a0 as ne}from"../../../chunks/singletons-01d2ecbe.js";import{l as Q,m as Z,g as M}from"../../../chunks/stores-988ac8b7.js";import{b as j,p as re}from"../../../chunks/firestore-ca500ac4.js";import{d as ae}from"../../../chunks/defaults-a8fffd7c.js";import{g as oe}from"../../../chunks/navigation-d93feb42.js";const ie=(a,n,t)=>{var o;const s=a.players.find(l=>n.uid===l.uid);if(!s)return;j({type:"game",id:a.id},"players",s,!0);const e=(o=s.progress)!=null?o:ae;e.linksProgressed++,e.linkHistory.push({url:t,type:"url",index:e.linkHistory.length}),j({type:"game",id:a.id},"players",{...s,progress:e}),Q.set(t)};function le(a){let n;return{c(){n=g("div"),this.h()},l(t){n=d(t,"DIV",{class:!0});var r=k(n);r.forEach(h),this.h()},h(){w(n,"class","container")},m(t,r){L(t,n,r),n.innerHTML=a[0],a[2](n)},p(t,[r]){r&1&&(n.innerHTML=t[0])},i:T,o:T,d(t){t&&h(n),a[2](null)}}}function ce(a,n,t){let r,s;y(a,Z,i=>t(3,r=i)),y(a,M,i=>t(4,s=i));let{html:e}=n,o;z(()=>o.querySelectorAll(`a[href*="${b}"]`).forEach(i=>i.onclick=l));const l=i=>{var p;i.preventDefault(),i.stopPropagation();const u=(p=i.target)==null?void 0:p.href,f=u.substring(u.indexOf(b)+b.length+1);ie(s,r,f)};function c(i){F[i?"unshift":"push"](()=>{o=i,t(1,o)})}return a.$$set=i=>{"html"in i&&t(0,e=i.html)},[e,o,c]}class ue extends N{constructor(n){super(),D(this,n,ce,le,I,{html:0})}}const fe=a=>({html:a&1,title:a&2}),q=a=>({html:a[0],title:a[1]});function pe(a){let n;const t=a[4].default,r=K(t,a,a[3],q);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,e){r&&r.m(s,e),n=!0},p(s,[e]){r&&r.p&&(!n||e&11)&&R(r,t,s,s[3],n?x(t,s[3],e,fe):X(s[3]),q)},i(s){n||(O(r,s),n=!0)},o(s){Y(r,s),n=!1},d(s){r&&r.d(s)}}}const me="https://en.wikipedia.org/w/api.php?origin=*&action=parse&format=json&page=",_e="Error",he="Error, no wikipedia page found";function ge(a,n,t){let{$$slots:r={},$$scope:s}=n,{wiki:e=""}=n,o="\uC7A0\uC2DC\uB9CC\uC694~",l="Loading...";return a.$$set=c=>{"wiki"in c&&t(2,e=c.wiki),"$$scope"in c&&t(3,s=c.$$scope)},a.$$.update=()=>{a.$$.dirty&4&&fetch(`${me}${e!=null?e:"Main_page"}`).then(c=>c.json()).then(c=>{var u,f,p,m;let i=(u=re(c,JSON.stringify,JSON.parse))==null?void 0:u.parse;t(1,l=(f=i==null?void 0:i.title)!=null?f:_e),t(0,o=(m=(p=i==null?void 0:i.text["*"])==null?void 0:p.replaceAll("/wiki/",`${b}/`))!=null?m:he)})},[o,l,e,s,r]}class de extends N{constructor(n){super(),D(this,n,ge,pe,I,{wiki:2})}}function G(a){let n,t,r,s,e,o,l,c,i,u,f,p;return{c(){n=g("div"),t=g("div"),r=g("p"),s=$("You Won!"),e=P(),o=g("p"),l=$("You go to the end first!"),c=P(),i=g("button"),u=$("Go home"),this.h()},l(m){n=d(m,"DIV",{class:!0});var E=k(n);t=d(E,"DIV",{class:!0});var v=k(t);r=d(v,"P",{});var A=k(r);s=H(A,"You Won!"),A.forEach(h),e=S(v),o=d(v,"P",{});var V=k(o);l=H(V,"You go to the end first!"),V.forEach(h),c=S(v),i=d(v,"BUTTON",{class:!0});var W=k(i);u=H(W,"Go home"),W.forEach(h),v.forEach(h),E.forEach(h),this.h()},h(){w(i,"class","button"),w(t,"class","card svelte-1mr5gns"),w(n,"class","winner svelte-1mr5gns")},m(m,E){L(m,n,E),_(n,t),_(t,r),_(r,s),_(t,e),_(t,o),_(o,l),_(t,c),_(t,i),_(i,u),f||(p=te(i,"click",a[2]),f=!0)},p:T,d(m){m&&h(n),f=!1,p()}}}function ke(a){var i;let n,t,r,s=((i=a[6])!=null?i:"[error]: missing title")+"",e,o,l,c;return l=new ue({props:{html:a[5]}}),{c(){n=g("section"),t=g("h1"),r=g("span"),e=$(s),o=P(),C(l.$$.fragment),this.h()},l(u){n=d(u,"SECTION",{class:!0});var f=k(n);t=d(f,"H1",{id:!0,class:!0});var p=k(t);r=d(p,"SPAN",{class:!0});var m=k(r);e=H(m,s),m.forEach(h),p.forEach(h),o=S(f),J(l.$$.fragment,f),f.forEach(h),this.h()},h(){w(r,"class","mw-page-title-main"),w(t,"id","firstHeading"),w(t,"class","firstHeading mw-first-heading"),w(n,"class","svelte-1mr5gns")},m(u,f){L(u,n,f),_(n,t),_(t,r),_(r,e),_(n,o),U(l,n,null),c=!0},p(u,f){var m;(!c||f&64)&&s!==(s=((m=u[6])!=null?m:"[error]: missing title")+"")&&se(e,s);const p={};f&32&&(p.html=u[5]),l.$set(p)},i(u){c||(O(l.$$.fragment,u),c=!0)},o(u){Y(l.$$.fragment,u),c=!1},d(u){u&&h(n),B(l)}}}function we(a){let n,t,r,s=a[1]&&G(a);return t=new de({props:{wiki:a[0],$$slots:{default:[ke,({html:e,title:o})=>({5:e,6:o}),({html:e,title:o})=>(e?32:0)|(o?64:0)]},$$scope:{ctx:a}}}),{c(){s&&s.c(),n=P(),C(t.$$.fragment)},l(e){s&&s.l(e),n=S(e),J(t.$$.fragment,e)},m(e,o){s&&s.m(e,o),L(e,n,o),U(t,e,o),r=!0},p(e,[o]){e[1]?s?s.p(e,o):(s=G(e),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null);const l={};o&1&&(l.wiki=e[0]),o&224&&(l.$$scope={dirty:o,ctx:e}),t.$set(l)},i(e){r||(O(t.$$.fragment,e),r=!0)},o(e){Y(t.$$.fragment,e),r=!1},d(e){s&&s.d(e),e&&h(n),B(t,e)}}}function ve(a,n,t){let r,s,e;y(a,M,c=>t(3,r=c)),y(a,Q,c=>t(0,s=c)),y(a,Z,c=>t(4,e=c));let o=!0;ee(()=>{if(e.uid===null||e.uid===""||e.gameId===""||s===""){l();return}});const l=()=>{ne(M,r={id:"",state:"waiting",route:[],players:[]},r),console.log("won"),oe(b)};return a.$$.update=()=>{a.$$.dirty&9&&s===r.route[r.route.length-1]&&t(1,o=!0)},[s,o,l,r]}class Pe extends N{constructor(n){super(),D(this,n,ve,we,I,{})}}export{Pe as default};
