import{A as ln,S as Be,i as Ve,s as $e,J as In,o as Je,a7 as An,T as Ge}from"./index-e3a647de.js";function Ye(n,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in n)){const i=Object.getOwnPropertyDescriptor(r,a);i&&Object.defineProperty(n,a,i.get?i:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const Yt=n=>{const t=new Array;for(let e=0;e<n.length-1;e++)t.push(He(n[e],n[e+1]));return{layers:t}},He=(n,t)=>{const e=new Array(n),r=new Array(t),a=r.fill(0).map(d=>Math.random()*2-1),i=e.fill(0).map(d=>r.map(y=>Math.random()*2-1));return{inputs:e,outputs:r,biases:a,weights:i}},Xe=n=>t=>n.layers.reduce((e,r)=>Ht(e,r),t),Ze=n=>t=>n.layers.reduce((e,r)=>{const a=Ht(e.input,r),i=e.output;return i.push({...r,inputs:e.input,outputs:a}),{input:a,output:i}},{input:t,output:[]}).output,Ht=(n,t)=>t.outputs.map((e,r)=>n.reduce((a,i,d)=>a+Qe(i*t.weights[d][r]),0)+t.biases[r]>0?1:0),Qe=n=>n,ke=ln(),Xt=ln(),Pn=ln(),Zt=ln({}),gn={simulation:{currentId:0,carSpots:[{box:{x:100,y:100,width:30,height:55,angle:0},brain:Yt([1,1]),destination:[0,0],color:"#000",dead:!0,fitness:0,performace:0,path:[]}],world:{generatedMap:{map:[{draw:n=>t=>null,rotate:0}],connections:[[!1,!1,!1,!1]],borders:[[[[0,0],[0,0]]]]},dim:1,size:{width:1,height:1},backgroundSaved:!1},destroyed:!1,layers:[6,4,6,5]},master:{gridSize:5,carAmount:20},brain:{sensorCount:5,sensorLength:200,sensorSpread:Math.PI/2,minFitness:-400},controls:{showNetwork:!0,cameraFocus:0,playerControls:!1,drawSensors:!1,cameraSpeed:.06,carThrust:2,maxSpeed:8,carTurnSpeed:.5,carBreakStrength:.4,friction:.04}},G={simulation:ln(gn.simulation),master:ln(gn.master),brain:ln(gn.brain),controls:ln(gn.controls)},ze={master:{gridSize:{type:"number",where:"master",min:2,max:100,step:1},carAmount:{type:"number",where:"master",min:2,max:1e3,step:10}},brain:{sensorCount:{type:"number",where:"brain",min:1,max:30,step:1},sensorLength:{type:"number",where:"brain",min:60,max:300,step:20},sensorSpread:{type:"number",where:"brain",min:0,max:Math.PI,step:.3},minFitness:{type:"number",where:"brain",min:-3e3,max:0,step:50}},controls:{cameraFocus:{type:"number",where:"controls",min:0,max:5,step:1},playerControls:{type:"checkbox",where:"controls"},showNetwork:{type:"checkbox",where:"controls"},drawSensors:{type:"checkbox",where:"controls"},cameraSpeed:{type:"number",where:"controls",min:0,max:.15,step:.001},carThrust:{type:"number",where:"controls",min:1,max:15,step:1},carTurnSpeed:{type:"number",where:"controls",min:.3,max:1.5,step:.1},carBreakStrength:{type:"number",where:"controls",min:.05,max:.3,step:.05},friction:{type:"number",where:"controls",min:.01,max:1,step:.01},maxSpeed:{type:"number",where:"controls",min:3,max:20,step:1}}};G.master.subscribe(({carAmount:n})=>ze.controls.cameraFocus.max=n-1);var U=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var X={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getEndomorphismMonoid=n.not=n.SK=n.hole=n.pipe=n.untupled=n.tupled=n.absurd=n.decrement=n.increment=n.tuple=n.flow=n.flip=n.constVoid=n.constUndefined=n.constNull=n.constFalse=n.constTrue=n.constant=n.unsafeCoerce=n.identity=n.apply=n.getRing=n.getSemiring=n.getMonoid=n.getSemigroup=n.getBooleanAlgebra=void 0;var t=function(f){return function(){return{meet:function(c,v){return function(S){return f.meet(c(S),v(S))}},join:function(c,v){return function(S){return f.join(c(S),v(S))}},zero:function(){return f.zero},one:function(){return f.one},implies:function(c,v){return function(S){return f.implies(c(S),v(S))}},not:function(c){return function(v){return f.not(c(v))}}}}};n.getBooleanAlgebra=t;var e=function(f){return function(){return{concat:function(c,v){return function(S){return f.concat(c(S),v(S))}}}}};n.getSemigroup=e;var r=function(f){var c=(0,n.getSemigroup)(f);return function(){return{concat:c().concat,empty:function(){return f.empty}}}};n.getMonoid=r;var a=function(f){return{add:function(c,v){return function(S){return f.add(c(S),v(S))}},zero:function(){return f.zero},mul:function(c,v){return function(S){return f.mul(c(S),v(S))}},one:function(){return f.one}}};n.getSemiring=a;var i=function(f){var c=(0,n.getSemiring)(f);return{add:c.add,mul:c.mul,one:c.one,zero:c.zero,sub:function(v,S){return function(W){return f.sub(v(W),S(W))}}}};n.getRing=i;var d=function(f){return function(c){return c(f)}};n.apply=d;function y(f){return f}n.identity=y,n.unsafeCoerce=y;function g(f){return function(){return f}}n.constant=g,n.constTrue=g(!0),n.constFalse=g(!1),n.constNull=g(null),n.constUndefined=g(void 0),n.constVoid=n.constUndefined;function b(f){return function(c,v){return f(v,c)}}n.flip=b;function _(f,c,v,S,W,D,K,x,cn){switch(arguments.length){case 1:return f;case 2:return function(){return c(f.apply(this,arguments))};case 3:return function(){return v(c(f.apply(this,arguments)))};case 4:return function(){return S(v(c(f.apply(this,arguments))))};case 5:return function(){return W(S(v(c(f.apply(this,arguments)))))};case 6:return function(){return D(W(S(v(c(f.apply(this,arguments))))))};case 7:return function(){return K(D(W(S(v(c(f.apply(this,arguments)))))))};case 8:return function(){return x(K(D(W(S(v(c(f.apply(this,arguments))))))))};case 9:return function(){return cn(x(K(D(W(S(v(c(f.apply(this,arguments)))))))))}}}n.flow=_;function M(){for(var f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];return f}n.tuple=M;function s(f){return f+1}n.increment=s;function I(f){return f-1}n.decrement=I;function R(f){throw new Error("Called `absurd` function which should be uncallable")}n.absurd=R;function P(f){return function(c){return f.apply(void 0,c)}}n.tupled=P;function j(f){return function(){for(var c=[],v=0;v<arguments.length;v++)c[v]=arguments[v];return f(c)}}n.untupled=j;function H(f,c,v,S,W,D,K,x,cn){switch(arguments.length){case 1:return f;case 2:return c(f);case 3:return v(c(f));case 4:return S(v(c(f)));case 5:return W(S(v(c(f))));case 6:return D(W(S(v(c(f)))));case 7:return K(D(W(S(v(c(f))))));case 8:return x(K(D(W(S(v(c(f)))))));case 9:return cn(x(K(D(W(S(v(c(f))))))));default:{for(var tn=arguments[0],en=1;en<arguments.length;en++)tn=arguments[en](tn);return tn}}}n.pipe=H,n.hole=R;var E=function(f,c){return c};n.SK=E;function O(f){return function(c){return!f(c)}}n.not=O;var w=function(){return{concat:function(f,c){return _(f,c)},empty:y}};n.getEndomorphismMonoid=w})(X);const nr=xe(X),tr=Ye({__proto__:null,default:nr},[X]);var Qt={},kt={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.eqDate=n.eqNumber=n.eqString=n.eqBoolean=n.eq=n.strictEqual=n.getStructEq=n.getTupleEq=n.Contravariant=n.getMonoid=n.getSemigroup=n.eqStrict=n.URI=n.contramap=n.tuple=n.struct=n.fromEquals=void 0;var t=X,e=function(_){return{equals:function(M,s){return M===s||_(M,s)}}};n.fromEquals=e;var r=function(_){return(0,n.fromEquals)(function(M,s){for(var I in _)if(!_[I].equals(M[I],s[I]))return!1;return!0})};n.struct=r;var a=function(){for(var _=[],M=0;M<arguments.length;M++)_[M]=arguments[M];return(0,n.fromEquals)(function(s,I){return _.every(function(R,P){return R.equals(s[P],I[P])})})};n.tuple=a;var i=function(_,M){return(0,t.pipe)(_,(0,n.contramap)(M))},d=function(_){return function(M){return(0,n.fromEquals)(function(s,I){return M.equals(_(s),_(I))})}};n.contramap=d,n.URI="Eq",n.eqStrict={equals:function(_,M){return _===M}};var y={equals:function(){return!0}},g=function(){return{concat:function(_,M){return(0,n.fromEquals)(function(s,I){return _.equals(s,I)&&M.equals(s,I)})}}};n.getSemigroup=g;var b=function(){return{concat:(0,n.getSemigroup)().concat,empty:y}};n.getMonoid=b,n.Contravariant={URI:n.URI,contramap:i},n.getTupleEq=n.tuple,n.getStructEq=n.struct,n.strictEqual=n.eqStrict.equals,n.eq=n.Contravariant,n.eqBoolean=n.eqStrict,n.eqString=n.eqStrict,n.eqNumber=n.eqStrict,n.eqDate={equals:function(_,M){return _.valueOf()===M.valueOf()}}})(kt);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ordDate=n.ordNumber=n.ordString=n.ordBoolean=n.ord=n.getDualOrd=n.getTupleOrd=n.between=n.clamp=n.max=n.min=n.geq=n.leq=n.gt=n.lt=n.equals=n.trivial=n.Contravariant=n.getMonoid=n.getSemigroup=n.URI=n.contramap=n.reverse=n.tuple=n.fromCompare=n.equalsDefault=void 0;var t=kt,e=X,r=function(c){return function(v,S){return v===S||c(v,S)===0}};n.equalsDefault=r;var a=function(c){return{equals:(0,n.equalsDefault)(c),compare:function(v,S){return v===S?0:c(v,S)}}};n.fromCompare=a;var i=function(){for(var c=[],v=0;v<arguments.length;v++)c[v]=arguments[v];return(0,n.fromCompare)(function(S,W){for(var D=0;D<c.length-1;D++){var K=c[D].compare(S[D],W[D]);if(K!==0)return K}return c[D].compare(S[D],W[D])})};n.tuple=i;var d=function(c){return(0,n.fromCompare)(function(v,S){return c.compare(S,v)})};n.reverse=d;var y=function(c,v){return(0,e.pipe)(c,(0,n.contramap)(v))},g=function(c){return function(v){return(0,n.fromCompare)(function(S,W){return v.compare(c(S),c(W))})}};n.contramap=g,n.URI="Ord";var b=function(){return{concat:function(c,v){return(0,n.fromCompare)(function(S,W){var D=c.compare(S,W);return D!==0?D:v.compare(S,W)})}}};n.getSemigroup=b;var _=function(){return{concat:(0,n.getSemigroup)().concat,empty:(0,n.fromCompare)(function(){return 0})}};n.getMonoid=_,n.Contravariant={URI:n.URI,contramap:y},n.trivial={equals:e.constTrue,compare:(0,e.constant)(0)};var M=function(c){return function(v){return function(S){return S===v||c.compare(S,v)===0}}};n.equals=M;var s=function(c){return function(v,S){return c.compare(v,S)===-1}};n.lt=s;var I=function(c){return function(v,S){return c.compare(v,S)===1}};n.gt=I;var R=function(c){return function(v,S){return c.compare(v,S)!==1}};n.leq=R;var P=function(c){return function(v,S){return c.compare(v,S)!==-1}};n.geq=P;var j=function(c){return function(v,S){return v===S||c.compare(v,S)<1?v:S}};n.min=j;var H=function(c){return function(v,S){return v===S||c.compare(v,S)>-1?v:S}};n.max=H;var E=function(c){var v=(0,n.min)(c),S=(0,n.max)(c);return function(W,D){return function(K){return S(v(K,D),W)}}};n.clamp=E;var O=function(c){var v=(0,n.lt)(c),S=(0,n.gt)(c);return function(W,D){return function(K){return!(v(K,W)||S(K,D))}}};n.between=O,n.getTupleOrd=n.tuple,n.getDualOrd=n.reverse,n.ord=n.Contravariant;function w(c,v){return c<v?-1:c>v?1:0}var f={equals:t.eqStrict.equals,compare:w};n.ordBoolean=f,n.ordString=f,n.ordNumber=f,n.ordDate=(0,e.pipe)(n.ordNumber,(0,n.contramap)(function(c){return c.valueOf()}))})(Qt);var Nt={},on={},J={},L={},er=U&&U.__spreadArray||function(n,t,e){if(e||arguments.length===2)for(var r=0,a=t.length,i;r<a;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return n.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(L,"__esModule",{value:!0});L.fromReadonlyNonEmptyArray=L.has=L.emptyRecord=L.emptyReadonlyArray=L.tail=L.head=L.isNonEmpty=L.singleton=L.right=L.left=L.isRight=L.isLeft=L.some=L.none=L.isSome=L.isNone=void 0;var rr=function(n){return n._tag==="None"};L.isNone=rr;var ar=function(n){return n._tag==="Some"};L.isSome=ar;L.none={_tag:"None"};var ir=function(n){return{_tag:"Some",value:n}};L.some=ir;var ur=function(n){return n._tag==="Left"};L.isLeft=ur;var cr=function(n){return n._tag==="Right"};L.isRight=cr;var lr=function(n){return{_tag:"Left",left:n}};L.left=lr;var or=function(n){return{_tag:"Right",right:n}};L.right=or;var fr=function(n){return[n]};L.singleton=fr;var hr=function(n){return n.length>0};L.isNonEmpty=hr;var dr=function(n){return n[0]};L.head=dr;var gr=function(n){return n.slice(1)};L.tail=gr;L.emptyReadonlyArray=[];L.emptyRecord={};L.has=Object.prototype.hasOwnProperty;var mr=function(n){return er([n[0]],n.slice(1),!0)};L.fromReadonlyNonEmptyArray=mr;var vr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),yr=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),br=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&vr(t,n,e);return yr(t,n),t};Object.defineProperty(J,"__esModule",{value:!0});var Cn=J.sequenceS=Tt=J.sequenceT=J.getApplySemigroup=J.apS=J.apSecond=J.apFirst=J.ap=void 0,_r=X,sr=br(L);function Sr(n,t){return function(e){return function(r){return n.ap(n.map(r,function(a){return function(i){return t.ap(a,i)}}),e)}}}J.ap=Sr;function Rr(n){return function(t){return function(e){return n.ap(n.map(e,function(r){return function(){return r}}),t)}}}J.apFirst=Rr;function Mr(n){return function(t){return function(e){return n.ap(n.map(e,function(){return function(r){return r}}),t)}}}J.apSecond=Mr;function wr(n){return function(t,e){return function(r){return n.ap(n.map(r,function(a){return function(i){var d;return Object.assign({},a,(d={},d[t]=i,d))}}),e)}}}J.apS=wr;function Ir(n){return function(t){return{concat:function(e,r){return n.ap(n.map(e,function(a){return function(i){return t.concat(a,i)}}),r)}}}}J.getApplySemigroup=Ir;function Ut(n,t,e){return function(r){for(var a=Array(e.length+1),i=0;i<e.length;i++)a[i]=e[i];return a[e.length]=r,t===0?n.apply(null,a):Ut(n,t-1,a)}}var bt={1:function(n){return[n]},2:function(n){return function(t){return[n,t]}},3:function(n){return function(t){return function(e){return[n,t,e]}}},4:function(n){return function(t){return function(e){return function(r){return[n,t,e,r]}}}},5:function(n){return function(t){return function(e){return function(r){return function(a){return[n,t,e,r,a]}}}}}};function Ar(n){return sr.has.call(bt,n)||(bt[n]=Ut(_r.tuple,n-1,[])),bt[n]}function Or(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.length,a=Ar(r),i=n.map(t[0],a),d=1;d<r;d++)i=n.ap(i,t[d]);return i}}var Tt=J.sequenceT=Or;function Er(n){var t=n.length;switch(t){case 1:return function(e){var r;return r={},r[n[0]]=e,r};case 2:return function(e){return function(r){var a;return a={},a[n[0]]=e,a[n[1]]=r,a}};case 3:return function(e){return function(r){return function(a){var i;return i={},i[n[0]]=e,i[n[1]]=r,i[n[2]]=a,i}}};case 4:return function(e){return function(r){return function(a){return function(i){var d;return d={},d[n[0]]=e,d[n[1]]=r,d[n[2]]=a,d[n[3]]=i,d}}}};case 5:return function(e){return function(r){return function(a){return function(i){return function(d){var y;return y={},y[n[0]]=e,y[n[1]]=r,y[n[2]]=a,y[n[3]]=i,y[n[4]]=d,y}}}}};default:return Ut(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var a={},i=0;i<t;i++)a[n[i]]=e[i];return a},t-1,[])}}function Pr(n){return function(t){for(var e=Object.keys(t),r=e.length,a=Er(e),i=n.map(t[e[0]],a),d=1;d<r;d++)i=n.ap(i,t[e[d]]);return i}}Cn=J.sequenceS=Pr;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.getFunctorComposition=Z.bindTo=Z.flap=Z.map=void 0;var Nr=X;function zt(n,t){return function(e){return function(r){return n.map(r,function(a){return t.map(a,e)})}}}Z.map=zt;function Ur(n){return function(t){return function(e){return n.map(e,function(r){return r(t)})}}}Z.flap=Ur;function Tr(n){return function(t){return function(e){return n.map(e,function(r){var a;return a={},a[t]=r,a})}}}Z.bindTo=Tr;function Lr(n,t){var e=zt(n,t);return{map:function(r,a){return(0,Nr.pipe)(r,e(a))}}}Z.getFunctorComposition=Lr;Object.defineProperty(on,"__esModule",{value:!0});on.getApplicativeComposition=on.getApplicativeMonoid=void 0;var xt=J,Fr=X,Cr=Z;function Wr(n){var t=(0,xt.getApplySemigroup)(n);return function(e){return{concat:t(e).concat,empty:n.of(e.empty)}}}on.getApplicativeMonoid=Wr;function qr(n,t){var e=(0,Cr.getFunctorComposition)(n,t).map,r=(0,xt.ap)(n,t);return{map:e,of:function(a){return n.of(t.of(a))},ap:function(a,i){return(0,Fr.pipe)(a,r(i))}}}on.getApplicativeComposition=qr;var un={};Object.defineProperty(un,"__esModule",{value:!0});un.bind=un.chainFirst=void 0;function Dr(n){return function(t){return function(e){return n.chain(e,function(r){return n.map(t(r),function(){return r})})}}}un.chainFirst=Dr;function jr(n){return function(t,e){return function(r){return n.chain(r,function(a){return n.map(e(a),function(i){var d;return Object.assign({},a,(d={},d[t]=i,d))})})}}}un.bind=jr;var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0});Wn.tailRec=void 0;var Kr=function(n,t){for(var e=t(n);e._tag==="Left";)e=t(e.left);return e.right};Wn.tailRec=Kr;var $={},pr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Br=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),Vr=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&pr(t,n,e);return Br(t,n),t};Object.defineProperty($,"__esModule",{value:!0});$.filterOrElse=$.chainFirstEitherK=$.chainEitherK=$.fromEitherK=$.chainOptionK=$.fromOptionK=$.fromPredicate=$.fromOption=void 0;var $r=un,Lt=X,vn=Vr(L);function ne(n){return function(t){return function(e){return n.fromEither(vn.isNone(e)?vn.left(t()):vn.right(e.value))}}}$.fromOption=ne;function Jr(n){return function(t,e){return function(r){return n.fromEither(t(r)?vn.right(r):vn.left(e(r)))}}}$.fromPredicate=Jr;function te(n){var t=ne(n);return function(e){var r=t(e);return function(a){return(0,Lt.flow)(a,r)}}}$.fromOptionK=te;function Gr(n,t){var e=te(n);return function(r){var a=e(r);return function(i){return function(d){return t.chain(d,a(i))}}}}$.chainOptionK=Gr;function Ft(n){return function(t){return(0,Lt.flow)(t,n.fromEither)}}$.fromEitherK=Ft;function Yr(n,t){var e=Ft(n);return function(r){return function(a){return t.chain(a,e(r))}}}$.chainEitherK=Yr;function Hr(n,t){return(0,Lt.flow)(Ft(n),(0,$r.chainFirst)(t))}$.chainFirstEitherK=Hr;function Xr(n,t){return function(e,r){return function(a){return t.chain(a,function(i){return n.fromEither(e(i)?vn.right(i):vn.left(r(i)))})}}}$.filterOrElse=Xr;var Ct={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.right=n.left=n.flap=n.Functor=n.Bifunctor=n.URI=n.bimap=n.mapLeft=n.map=n.separated=void 0;var t=X,e=Z,r=function(s,I){return{left:s,right:I}};n.separated=r;var a=function(s,I){return(0,t.pipe)(s,(0,n.map)(I))},i=function(s,I){return(0,t.pipe)(s,(0,n.mapLeft)(I))},d=function(s,I,R){return(0,t.pipe)(s,(0,n.bimap)(I,R))},y=function(s){return function(I){return(0,n.separated)((0,n.left)(I),s((0,n.right)(I)))}};n.map=y;var g=function(s){return function(I){return(0,n.separated)(s((0,n.left)(I)),(0,n.right)(I))}};n.mapLeft=g;var b=function(s,I){return function(R){return(0,n.separated)(s((0,n.left)(R)),I((0,n.right)(R)))}};n.bimap=b,n.URI="Separated",n.Bifunctor={URI:n.URI,mapLeft:i,bimap:d},n.Functor={URI:n.URI,map:a},n.flap=(0,e.flap)(n.Functor);var _=function(s){return s.left};n.left=_;var M=function(s){return s.right};n.right=M})(Ct);var an={},Zr=U&&U.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var a=Object.getOwnPropertyDescriptor(t,e);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,a)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Qr=U&&U.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),kr=U&&U.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&Zr(t,n,e);return Qr(t,n),t};Object.defineProperty(an,"__esModule",{value:!0});an.filterE=an.witherDefault=an.wiltDefault=void 0;var Kt=kr(L);function zr(n,t){return function(e){var r=n.traverse(e);return function(a,i){return e.map(r(a,i),t.separate)}}}an.wiltDefault=zr;function xr(n,t){return function(e){var r=n.traverse(e);return function(a,i){return e.map(r(a,i),t.compact)}}}an.witherDefault=xr;function na(n){return function(t){var e=n.wither(t);return function(r){return function(a){return e(a,function(i){return t.map(r(i),function(d){return d?Kt.some(i):Kt.none})})}}}}an.filterE=na;(function(n){var t=U&&U.__createBinding||(Object.create?function(o,u,m,C){C===void 0&&(C=m);var Y=Object.getOwnPropertyDescriptor(u,m);(!Y||("get"in Y?!u.__esModule:Y.writable||Y.configurable))&&(Y={enumerable:!0,get:function(){return u[m]}}),Object.defineProperty(o,C,Y)}:function(o,u,m,C){C===void 0&&(C=m),o[C]=u[m]}),e=U&&U.__setModuleDefault||(Object.create?function(o,u){Object.defineProperty(o,"default",{enumerable:!0,value:u})}:function(o,u){o.default=u}),r=U&&U.__importStar||function(o){if(o&&o.__esModule)return o;var u={};if(o!=null)for(var m in o)m!=="default"&&Object.prototype.hasOwnProperty.call(o,m)&&t(u,o,m);return e(u,o),u};Object.defineProperty(n,"__esModule",{value:!0}),n.fold=n.match=n.foldW=n.matchW=n.isRight=n.isLeft=n.fromOption=n.fromPredicate=n.FromEither=n.MonadThrow=n.throwError=n.ChainRec=n.Extend=n.extend=n.Alt=n.alt=n.altW=n.Bifunctor=n.mapLeft=n.bimap=n.Traversable=n.sequence=n.traverse=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.chainW=n.Applicative=n.Apply=n.ap=n.apW=n.Pointed=n.of=n.Functor=n.map=n.getAltValidation=n.getApplicativeValidation=n.getWitherable=n.getFilterable=n.getCompactable=n.getSemigroup=n.getEq=n.getShow=n.URI=n.right=n.left=void 0,n.getValidation=n.getValidationMonoid=n.getValidationSemigroup=n.getApplyMonoid=n.getApplySemigroup=n.either=n.stringifyJSON=n.parseJSON=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apSW=n.apS=n.bindW=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toError=n.toUnion=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.orElse=n.orElseW=n.swap=n.filterOrElseW=n.filterOrElse=n.chainOptionK=n.fromOptionK=n.duplicate=n.flatten=n.flattenW=n.chainFirstW=n.chainFirst=n.apSecondW=n.apSecond=n.apFirstW=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=void 0;var a=on,i=J,d=un,y=Wn,g=$,b=X,_=Z,M=r(L),s=Ct,I=an;n.left=M.left,n.right=M.right;var R=function(o,u){return(0,b.pipe)(o,(0,n.map)(u))},P=function(o,u){return(0,b.pipe)(o,(0,n.ap)(u))},j=function(o,u){return(0,b.pipe)(o,(0,n.chain)(u))},H=function(o,u,m){return(0,b.pipe)(o,(0,n.reduce)(u,m))},E=function(o){return function(u,m){var C=(0,n.foldMap)(o);return(0,b.pipe)(u,C(m))}},O=function(o,u,m){return(0,b.pipe)(o,(0,n.reduceRight)(u,m))},w=function(o){var u=(0,n.traverse)(o);return function(m,C){return(0,b.pipe)(m,u(C))}},f=function(o,u,m){return(0,b.pipe)(o,(0,n.bimap)(u,m))},c=function(o,u){return(0,b.pipe)(o,(0,n.mapLeft)(u))},v=function(o,u){return(0,b.pipe)(o,(0,n.alt)(u))},S=function(o,u){return(0,b.pipe)(o,(0,n.extend)(u))},W=function(o,u){return(0,y.tailRec)(u(o),function(m){return(0,n.isLeft)(m)?(0,n.right)((0,n.left)(m.left)):(0,n.isLeft)(m.right)?(0,n.left)(u(m.right.left)):(0,n.right)((0,n.right)(m.right.right))})};n.URI="Either";var D=function(o,u){return{show:function(m){return(0,n.isLeft)(m)?"left(".concat(o.show(m.left),")"):"right(".concat(u.show(m.right),")")}}};n.getShow=D;var K=function(o,u){return{equals:function(m,C){return m===C||((0,n.isLeft)(m)?(0,n.isLeft)(C)&&o.equals(m.left,C.left):(0,n.isRight)(C)&&u.equals(m.right,C.right))}}};n.getEq=K;var x=function(o){return{concat:function(u,m){return(0,n.isLeft)(m)?u:(0,n.isLeft)(u)?m:(0,n.right)(o.concat(u.right,m.right))}}};n.getSemigroup=x;var cn=function(o){var u=(0,n.left)(o.empty);return{URI:n.URI,_E:void 0,compact:function(m){return(0,n.isLeft)(m)?m:m.right._tag==="None"?u:(0,n.right)(m.right.value)},separate:function(m){return(0,n.isLeft)(m)?(0,s.separated)(m,m):(0,n.isLeft)(m.right)?(0,s.separated)((0,n.right)(m.right.left),u):(0,s.separated)(u,(0,n.right)(m.right.right))}}};n.getCompactable=cn;var tn=function(o){var u=(0,n.left)(o.empty),m=(0,n.getCompactable)(o),C=m.compact,Y=m.separate,fn=function(p,l){return(0,n.isLeft)(p)||l(p.right)?p:u},yt=function(p,l){return(0,n.isLeft)(p)?(0,s.separated)(p,p):l(p.right)?(0,s.separated)(u,(0,n.right)(p.right)):(0,s.separated)((0,n.right)(p.right),u)};return{URI:n.URI,_E:void 0,map:R,compact:C,separate:Y,filter:fn,filterMap:function(p,l){if((0,n.isLeft)(p))return p;var h=l(p.right);return h._tag==="None"?u:(0,n.right)(h.value)},partition:yt,partitionMap:function(p,l){if((0,n.isLeft)(p))return(0,s.separated)(p,p);var h=l(p.right);return(0,n.isLeft)(h)?(0,s.separated)((0,n.right)(h.left),u):(0,s.separated)(u,(0,n.right)(h.right))}}};n.getFilterable=tn;var en=function(o){var u=(0,n.getFilterable)(o),m=(0,n.getCompactable)(o);return{URI:n.URI,_E:void 0,map:R,compact:u.compact,separate:u.separate,filter:u.filter,filterMap:u.filterMap,partition:u.partition,partitionMap:u.partitionMap,traverse:w,sequence:n.sequence,reduce:H,foldMap:E,reduceRight:O,wither:(0,I.witherDefault)(n.Traversable,m),wilt:(0,I.wiltDefault)(n.Traversable,m)}};n.getWitherable=en;var Kn=function(o){return{URI:n.URI,_E:void 0,map:R,ap:function(u,m){return(0,n.isLeft)(u)?(0,n.isLeft)(m)?(0,n.left)(o.concat(u.left,m.left)):u:(0,n.isLeft)(m)?m:(0,n.right)(u.right(m.right))},of:n.of}};n.getApplicativeValidation=Kn;var pn=function(o){return{URI:n.URI,_E:void 0,map:R,alt:function(u,m){if((0,n.isRight)(u))return u;var C=m();return(0,n.isLeft)(C)?(0,n.left)(o.concat(u.left,C.left)):C}}};n.getAltValidation=pn;var Bn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(o(u.right))}};n.map=Bn,n.Functor={URI:n.URI,map:R},n.of=n.right,n.Pointed={URI:n.URI,of:n.of};var Vn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.isLeft)(o)?o:(0,n.right)(u.right(o.right))}};n.apW=Vn,n.ap=n.apW,n.Apply={URI:n.URI,map:R,ap:P},n.Applicative={URI:n.URI,map:R,ap:P,of:n.of};var $n=function(o){return function(u){return(0,n.isLeft)(u)?u:o(u.right)}};n.chainW=$n,n.chain=n.chainW,n.Chain={URI:n.URI,map:R,ap:P,chain:j},n.Monad={URI:n.URI,map:R,ap:P,of:n.of,chain:j};var Jn=function(o,u){return function(m){return(0,n.isLeft)(m)?o:u(o,m.right)}};n.reduce=Jn;var Gn=function(o){return function(u){return function(m){return(0,n.isLeft)(m)?o.empty:u(m.right)}}};n.foldMap=Gn;var Yn=function(o,u){return function(m){return(0,n.isLeft)(m)?o:u(m.right,o)}};n.reduceRight=Yn,n.Foldable={URI:n.URI,reduce:H,foldMap:E,reduceRight:O};var Hn=function(o){return function(u){return function(m){return(0,n.isLeft)(m)?o.of((0,n.left)(m.left)):o.map(u(m.right),n.right)}}};n.traverse=Hn;var Xn=function(o){return function(u){return(0,n.isLeft)(u)?o.of((0,n.left)(u.left)):o.map(u.right,n.right)}};n.sequence=Xn,n.Traversable={URI:n.URI,map:R,reduce:H,foldMap:E,reduceRight:O,traverse:w,sequence:n.sequence};var Zn=function(o,u){return function(m){return(0,n.isLeft)(m)?(0,n.left)(o(m.left)):(0,n.right)(u(m.right))}};n.bimap=Zn;var Qn=function(o){return function(u){return(0,n.isLeft)(u)?(0,n.left)(o(u.left)):u}};n.mapLeft=Qn,n.Bifunctor={URI:n.URI,bimap:f,mapLeft:c};var kn=function(o){return function(u){return(0,n.isLeft)(u)?o():u}};n.altW=kn,n.alt=n.altW,n.Alt={URI:n.URI,map:R,alt:v};var zn=function(o){return function(u){return(0,n.isLeft)(u)?u:(0,n.right)(o(u))}};n.extend=zn,n.Extend={URI:n.URI,map:R,extend:S},n.ChainRec={URI:n.URI,map:R,ap:P,chain:j,chainRec:W},n.throwError=n.left,n.MonadThrow={URI:n.URI,map:R,ap:P,of:n.of,chain:j,throwError:n.throwError},n.FromEither={URI:n.URI,fromEither:b.identity},n.fromPredicate=(0,g.fromPredicate)(n.FromEither),n.fromOption=(0,g.fromOption)(n.FromEither),n.isLeft=M.isLeft,n.isRight=M.isRight;var xn=function(o,u){return function(m){return(0,n.isLeft)(m)?o(m.left):u(m.right)}};n.matchW=xn,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var nt=function(o){return function(u){return(0,n.isLeft)(u)?o(u.left):u.right}};n.getOrElseW=nt,n.getOrElse=n.getOrElseW,n.flap=(0,_.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apFirstW=n.apFirst,n.apSecond=(0,i.apSecond)(n.Apply),n.apSecondW=n.apSecond,n.chainFirst=(0,d.chainFirst)(n.Chain),n.chainFirstW=n.chainFirst,n.flattenW=(0,n.chainW)(b.identity),n.flatten=n.flattenW,n.duplicate=(0,n.extend)(b.identity),n.fromOptionK=(0,g.fromOptionK)(n.FromEither),n.chainOptionK=(0,g.chainOptionK)(n.FromEither,n.Chain),n.filterOrElse=(0,g.filterOrElse)(n.FromEither,n.Chain),n.filterOrElseW=n.filterOrElse;var tt=function(o){return(0,n.isLeft)(o)?(0,n.right)(o.left):(0,n.left)(o.right)};n.swap=tt;var et=function(o){return function(u){return(0,n.isLeft)(u)?o(u.left):u}};n.orElseW=et,n.orElse=n.orElseW;var rt=function(o){return function(u){return u==null?(0,n.left)(o):(0,n.right)(u)}};n.fromNullable=rt;var at=function(o,u){try{return(0,n.right)(o())}catch(m){return(0,n.left)(u(m))}};n.tryCatch=at;var it=function(o,u){return function(){for(var m=[],C=0;C<arguments.length;C++)m[C]=arguments[C];return(0,n.tryCatch)(function(){return o.apply(void 0,m)},u)}};n.tryCatchK=it;var sn=function(o){var u=(0,n.fromNullable)(o);return function(m){return(0,b.flow)(m,u)}};n.fromNullableK=sn;var Sn=function(o){var u=(0,n.fromNullableK)(o);return function(m){return(0,n.chain)(u(m))}};n.chainNullableK=Sn,n.toUnion=(0,n.foldW)(b.identity,b.identity);function ut(o){return o instanceof Error?o:new Error(String(o))}n.toError=ut;function wn(o){return function(u,m){if(m===void 0){var C=wn(o);return function(Y){return C(u,Y)}}return(0,n.isLeft)(m)?!1:o.equals(u,m.right)}}n.elem=wn;var ct=function(o){return function(u){return(0,n.isLeft)(u)?!1:o(u.right)}};n.exists=ct,n.Do=(0,n.of)(M.emptyRecord),n.bindTo=(0,_.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.bindW=n.bind,n.apS=(0,i.apS)(n.Apply),n.apSW=n.apS,n.ApT=(0,n.of)(M.emptyReadonlyArray);var lt=function(o){return function(u){var m=o(0,M.head(u));if((0,n.isLeft)(m))return m;for(var C=[m.right],Y=1;Y<u.length;Y++){var fn=o(Y,u[Y]);if((0,n.isLeft)(fn))return fn;C.push(fn.right)}return(0,n.right)(C)}};n.traverseReadonlyNonEmptyArrayWithIndex=lt;var ot=function(o){var u=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(o);return function(m){return M.isNonEmpty(m)?u(m):n.ApT}};n.traverseReadonlyArrayWithIndex=ot,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var ft=function(o){return(0,n.traverseReadonlyArrayWithIndex)(function(u,m){return o(m)})};n.traverseArray=ft,n.sequenceArray=(0,n.traverseArray)(b.identity);function ht(o,u){return(0,n.tryCatch)(function(){return JSON.parse(o)},u)}n.parseJSON=ht;var dt=function(o,u){return(0,n.tryCatch)(function(){var m=JSON.stringify(o);if(typeof m!="string")throw new Error("Converting unsupported structure to JSON");return m},u)};n.stringifyJSON=dt,n.either={URI:n.URI,map:R,of:n.of,ap:P,chain:j,reduce:H,foldMap:E,reduceRight:O,traverse:w,sequence:n.sequence,bimap:f,mapLeft:c,alt:v,extend:S,chainRec:W,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var gt=function(o,u){return(0,i.getApplySemigroup)((0,n.getApplicativeValidation)(o))(u)};n.getValidationSemigroup=gt;var mt=function(o,u){return(0,a.getApplicativeMonoid)((0,n.getApplicativeValidation)(o))(u)};n.getValidationMonoid=mt;function vt(o){var u=(0,n.getApplicativeValidation)(o).ap,m=(0,n.getAltValidation)(o).alt;return{URI:n.URI,_E:void 0,map:R,of:n.of,chain:j,bimap:f,mapLeft:c,reduce:H,foldMap:E,reduceRight:O,extend:S,traverse:w,sequence:n.sequence,chainRec:W,throwError:n.throwError,ap:u,alt:m}}n.getValidation=vt})(Nt);var Wt={},ee={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.and=n.or=n.not=n.Contravariant=n.getMonoidAll=n.getSemigroupAll=n.getMonoidAny=n.getSemigroupAny=n.URI=n.contramap=void 0;var t=X,e=function(M,s){return(0,t.pipe)(M,(0,n.contramap)(s))},r=function(M){return function(s){return(0,t.flow)(M,s)}};n.contramap=r,n.URI="Predicate";var a=function(){return{concat:function(M,s){return(0,t.pipe)(M,(0,n.or)(s))}}};n.getSemigroupAny=a;var i=function(){return{concat:(0,n.getSemigroupAny)().concat,empty:t.constFalse}};n.getMonoidAny=i;var d=function(){return{concat:function(M,s){return(0,t.pipe)(M,(0,n.and)(s))}}};n.getSemigroupAll=d;var y=function(){return{concat:(0,n.getSemigroupAll)().concat,empty:t.constTrue}};n.getMonoidAll=y,n.Contravariant={URI:n.URI,contramap:e};var g=function(M){return function(s){return!M(s)}};n.not=g;var b=function(M){return function(s){return function(I){return s(I)||M(I)}}};n.or=b;var _=function(M){return function(s){return function(I){return s(I)&&M(I)}}};n.and=_})(ee);var re={},z={};Object.defineProperty(z,"__esModule",{value:!0});z.concatAll=z.endo=z.filterSecond=z.filterFirst=z.reverse=void 0;var ta=function(n){return{concat:function(t,e){return n.concat(e,t)}}};z.reverse=ta;var ea=function(n){return function(t){return{concat:function(e,r){return n(e)?t.concat(e,r):r}}}};z.filterFirst=ea;var ra=function(n){return function(t){return{concat:function(e,r){return n(r)?t.concat(e,r):e}}}};z.filterSecond=ra;var aa=function(n){return function(t){return{concat:function(e,r){return t.concat(n(e),n(r))}}}};z.endo=aa;var ia=function(n){return function(t){return function(e){return e.reduce(function(r,a){return n.concat(r,a)},t)}}};z.concatAll=ia;(function(n){var t=U&&U.__createBinding||(Object.create?function(E,O,w,f){f===void 0&&(f=w);var c=Object.getOwnPropertyDescriptor(O,w);(!c||("get"in c?!O.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return O[w]}}),Object.defineProperty(E,f,c)}:function(E,O,w,f){f===void 0&&(f=w),E[f]=O[w]}),e=U&&U.__setModuleDefault||(Object.create?function(E,O){Object.defineProperty(E,"default",{enumerable:!0,value:O})}:function(E,O){E.default=O}),r=U&&U.__importStar||function(E){if(E&&E.__esModule)return E;var O={};if(E!=null)for(var w in E)w!=="default"&&Object.prototype.hasOwnProperty.call(E,w)&&t(O,E,w);return e(O,E),O};Object.defineProperty(n,"__esModule",{value:!0}),n.semigroupProduct=n.semigroupSum=n.semigroupString=n.getFunctionSemigroup=n.semigroupAny=n.semigroupAll=n.fold=n.getIntercalateSemigroup=n.getMeetSemigroup=n.getJoinSemigroup=n.getDualSemigroup=n.getStructSemigroup=n.getTupleSemigroup=n.getFirstSemigroup=n.getLastSemigroup=n.getObjectSemigroup=n.semigroupVoid=n.concatAll=n.last=n.first=n.intercalate=n.tuple=n.struct=n.reverse=n.constant=n.max=n.min=void 0;var a=X,i=r(L),d=r(z),y=r(Qt),g=function(E){return{concat:y.min(E)}};n.min=g;var b=function(E){return{concat:y.max(E)}};n.max=b;var _=function(E){return{concat:function(){return E}}};n.constant=_,n.reverse=d.reverse;var M=function(E){return{concat:function(O,w){var f={};for(var c in E)i.has.call(E,c)&&(f[c]=E[c].concat(O[c],w[c]));return f}}};n.struct=M;var s=function(){for(var E=[],O=0;O<arguments.length;O++)E[O]=arguments[O];return{concat:function(w,f){return E.map(function(c,v){return c.concat(w[v],f[v])})}}};n.tuple=s;var I=function(E){return function(O){return{concat:function(w,f){return O.concat(w,O.concat(E,f))}}}};n.intercalate=I;var R=function(){return{concat:a.identity}};n.first=R;var P=function(){return{concat:function(E,O){return O}}};n.last=P,n.concatAll=d.concatAll,n.semigroupVoid=(0,n.constant)(void 0);var j=function(){return{concat:function(E,O){return Object.assign({},E,O)}}};n.getObjectSemigroup=j,n.getLastSemigroup=n.last,n.getFirstSemigroup=n.first,n.getTupleSemigroup=n.tuple,n.getStructSemigroup=n.struct,n.getDualSemigroup=n.reverse,n.getJoinSemigroup=n.max,n.getMeetSemigroup=n.min,n.getIntercalateSemigroup=n.intercalate;function H(E){var O=(0,n.concatAll)(E);return function(w,f){return f===void 0?O(w):O(w)(f)}}n.fold=H,n.semigroupAll={concat:function(E,O){return E&&O}},n.semigroupAny={concat:function(E,O){return E||O}},n.getFunctionSemigroup=a.getSemigroup,n.semigroupString={concat:function(E,O){return E+O}},n.semigroupSum={concat:function(E,O){return E+O}},n.semigroupProduct={concat:function(E,O){return E*O}}})(re);var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.guard=void 0;function ua(n,t){return function(e){return e?t.of(void 0):n.zero()}}qn.guard=ua;(function(n){var t=U&&U.__createBinding||(Object.create?function(l,h,A,B){B===void 0&&(B=A);var Q=Object.getOwnPropertyDescriptor(h,A);(!Q||("get"in Q?!h.__esModule:Q.writable||Q.configurable))&&(Q={enumerable:!0,get:function(){return h[A]}}),Object.defineProperty(l,B,Q)}:function(l,h,A,B){B===void 0&&(B=A),l[B]=h[A]}),e=U&&U.__setModuleDefault||(Object.create?function(l,h){Object.defineProperty(l,"default",{enumerable:!0,value:h})}:function(l,h){l.default=h}),r=U&&U.__importStar||function(l){if(l&&l.__esModule)return l;var h={};if(l!=null)for(var A in l)A!=="default"&&Object.prototype.hasOwnProperty.call(l,A)&&t(h,l,A);return e(h,l),h};Object.defineProperty(n,"__esModule",{value:!0}),n.fromEither=n.MonadThrow=n.throwError=n.Witherable=n.wilt=n.wither=n.Traversable=n.sequence=n.traverse=n.Filterable=n.partitionMap=n.partition=n.filterMap=n.filter=n.Compactable=n.separate=n.compact=n.Extend=n.extend=n.Alternative=n.guard=n.Zero=n.zero=n.Alt=n.alt=n.altW=n.Foldable=n.reduceRight=n.foldMap=n.reduce=n.Monad=n.Chain=n.chain=n.Applicative=n.Apply=n.ap=n.Pointed=n.of=n.Functor=n.map=n.getMonoid=n.getOrd=n.getEq=n.getShow=n.URI=n.getRight=n.getLeft=n.fromPredicate=n.some=n.none=void 0,n.getLastMonoid=n.getFirstMonoid=n.getApplyMonoid=n.getApplySemigroup=n.option=n.mapNullable=n.getRefinement=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.exists=n.elem=n.toUndefined=n.toNullable=n.chainNullableK=n.fromNullableK=n.tryCatchK=n.tryCatch=n.fromNullable=n.chainFirstEitherK=n.chainEitherK=n.fromEitherK=n.duplicate=n.chainFirst=n.flatten=n.apSecond=n.apFirst=n.flap=n.getOrElse=n.getOrElseW=n.fold=n.match=n.foldW=n.matchW=n.isNone=n.isSome=n.FromEither=void 0;var a=on,i=J,d=un,y=$,g=X,b=Z,_=r(L),M=ee,s=re,I=Ct,R=an,P=qn;n.none=_.none,n.some=_.some;function j(l){return function(h){return l(h)?(0,n.some)(h):n.none}}n.fromPredicate=j;var H=function(l){return l._tag==="Right"?n.none:(0,n.some)(l.left)};n.getLeft=H;var E=function(l){return l._tag==="Left"?n.none:(0,n.some)(l.right)};n.getRight=E;var O=function(l,h){return(0,g.pipe)(l,(0,n.map)(h))},w=function(l,h){return(0,g.pipe)(l,(0,n.ap)(h))},f=function(l,h){return(0,g.pipe)(l,(0,n.chain)(h))},c=function(l,h,A){return(0,g.pipe)(l,(0,n.reduce)(h,A))},v=function(l){var h=(0,n.foldMap)(l);return function(A,B){return(0,g.pipe)(A,h(B))}},S=function(l,h,A){return(0,g.pipe)(l,(0,n.reduceRight)(h,A))},W=function(l){var h=(0,n.traverse)(l);return function(A,B){return(0,g.pipe)(A,h(B))}},D=function(l,h){return(0,g.pipe)(l,(0,n.alt)(h))},K=function(l,h){return(0,g.pipe)(l,(0,n.filter)(h))},x=function(l,h){return(0,g.pipe)(l,(0,n.filterMap)(h))},cn=function(l,h){return(0,g.pipe)(l,(0,n.extend)(h))},tn=function(l,h){return(0,g.pipe)(l,(0,n.partition)(h))},en=function(l,h){return(0,g.pipe)(l,(0,n.partitionMap)(h))};n.URI="Option";var Kn=function(l){return{show:function(h){return(0,n.isNone)(h)?"none":"some(".concat(l.show(h.value),")")}}};n.getShow=Kn;var pn=function(l){return{equals:function(h,A){return h===A||((0,n.isNone)(h)?(0,n.isNone)(A):(0,n.isNone)(A)?!1:l.equals(h.value,A.value))}}};n.getEq=pn;var Bn=function(l){return{equals:(0,n.getEq)(l).equals,compare:function(h,A){return h===A?0:(0,n.isSome)(h)?(0,n.isSome)(A)?l.compare(h.value,A.value):1:-1}}};n.getOrd=Bn;var Vn=function(l){return{concat:function(h,A){return(0,n.isNone)(h)?A:(0,n.isNone)(A)?h:(0,n.some)(l.concat(h.value,A.value))},empty:n.none}};n.getMonoid=Vn;var $n=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(l(h.value))}};n.map=$n,n.Functor={URI:n.URI,map:O},n.of=n.some,n.Pointed={URI:n.URI,of:n.of};var Jn=function(l){return function(h){return(0,n.isNone)(h)||(0,n.isNone)(l)?n.none:(0,n.some)(h.value(l.value))}};n.ap=Jn,n.Apply={URI:n.URI,map:O,ap:w},n.Applicative={URI:n.URI,map:O,ap:w,of:n.of};var Gn=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)}};n.chain=Gn,n.Chain={URI:n.URI,map:O,ap:w,chain:f},n.Monad={URI:n.URI,map:O,ap:w,of:n.of,chain:f};var Yn=function(l,h){return function(A){return(0,n.isNone)(A)?l:h(l,A.value)}};n.reduce=Yn;var Hn=function(l){return function(h){return function(A){return(0,n.isNone)(A)?l.empty:h(A.value)}}};n.foldMap=Hn;var Xn=function(l,h){return function(A){return(0,n.isNone)(A)?l:h(A.value,l)}};n.reduceRight=Xn,n.Foldable={URI:n.URI,reduce:c,foldMap:v,reduceRight:S};var Zn=function(l){return function(h){return(0,n.isNone)(h)?l():h}};n.altW=Zn,n.alt=n.altW,n.Alt={URI:n.URI,map:O,alt:D};var Qn=function(){return n.none};n.zero=Qn,n.Zero={URI:n.URI,zero:n.zero},n.guard=(0,P.guard)(n.Zero,n.Pointed),n.Alternative={URI:n.URI,map:O,ap:w,of:n.of,alt:D,zero:n.zero};var kn=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.some)(l(h))}};n.extend=kn,n.Extend={URI:n.URI,map:O,extend:cn},n.compact=(0,n.chain)(g.identity);var zn=(0,I.separated)(n.none,n.none),xn=function(l){return(0,n.isNone)(l)?zn:(0,I.separated)((0,n.getLeft)(l.value),(0,n.getRight)(l.value))};n.separate=xn,n.Compactable={URI:n.URI,compact:n.compact,separate:n.separate};var nt=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)?h:n.none}};n.filter=nt;var tt=function(l){return function(h){return(0,n.isNone)(h)?n.none:l(h.value)}};n.filterMap=tt;var et=function(l){return function(h){return(0,I.separated)(K(h,(0,M.not)(l)),K(h,l))}};n.partition=et;var rt=function(l){return(0,g.flow)((0,n.map)(l),n.separate)};n.partitionMap=rt,n.Filterable={URI:n.URI,map:O,compact:n.compact,separate:n.separate,filter:K,filterMap:x,partition:tn,partitionMap:en};var at=function(l){return function(h){return function(A){return(0,n.isNone)(A)?l.of(n.none):l.map(h(A.value),n.some)}}};n.traverse=at;var it=function(l){return function(h){return(0,n.isNone)(h)?l.of(n.none):l.map(h.value,n.some)}};n.sequence=it,n.Traversable={URI:n.URI,map:O,reduce:c,foldMap:v,reduceRight:S,traverse:W,sequence:n.sequence};var sn=(0,R.witherDefault)(n.Traversable,n.Compactable),Sn=(0,R.wiltDefault)(n.Traversable,n.Compactable),ut=function(l){var h=sn(l);return function(A){return function(B){return h(B,A)}}};n.wither=ut;var wn=function(l){var h=Sn(l);return function(A){return function(B){return h(B,A)}}};n.wilt=wn,n.Witherable={URI:n.URI,map:O,reduce:c,foldMap:v,reduceRight:S,traverse:W,sequence:n.sequence,compact:n.compact,separate:n.separate,filter:K,filterMap:x,partition:tn,partitionMap:en,wither:sn,wilt:Sn};var ct=function(){return n.none};n.throwError=ct,n.MonadThrow={URI:n.URI,map:O,ap:w,of:n.of,chain:f,throwError:n.throwError},n.fromEither=n.getRight,n.FromEither={URI:n.URI,fromEither:n.fromEither},n.isSome=_.isSome;var lt=function(l){return l._tag==="None"};n.isNone=lt;var ot=function(l,h){return function(A){return(0,n.isNone)(A)?l():h(A.value)}};n.matchW=ot,n.foldW=n.matchW,n.match=n.matchW,n.fold=n.match;var ft=function(l){return function(h){return(0,n.isNone)(h)?l():h.value}};n.getOrElseW=ft,n.getOrElse=n.getOrElseW,n.flap=(0,b.flap)(n.Functor),n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.flatten=n.compact,n.chainFirst=(0,d.chainFirst)(n.Chain),n.duplicate=(0,n.extend)(g.identity),n.fromEitherK=(0,y.fromEitherK)(n.FromEither),n.chainEitherK=(0,y.chainEitherK)(n.FromEither,n.Chain),n.chainFirstEitherK=(0,y.chainFirstEitherK)(n.FromEither,n.Chain);var ht=function(l){return l==null?n.none:(0,n.some)(l)};n.fromNullable=ht;var dt=function(l){try{return(0,n.some)(l())}catch{return n.none}};n.tryCatch=dt;var gt=function(l){return function(){for(var h=[],A=0;A<arguments.length;A++)h[A]=arguments[A];return(0,n.tryCatch)(function(){return l.apply(void 0,h)})}};n.tryCatchK=gt;var mt=function(l){return(0,g.flow)(l,n.fromNullable)};n.fromNullableK=mt;var vt=function(l){return function(h){return(0,n.isNone)(h)?n.none:(0,n.fromNullable)(l(h.value))}};n.chainNullableK=vt,n.toNullable=(0,n.match)(g.constNull,g.identity),n.toUndefined=(0,n.match)(g.constUndefined,g.identity);function o(l){return function(h,A){if(A===void 0){var B=o(l);return function(Q){return B(h,Q)}}return(0,n.isNone)(A)?!1:l.equals(h,A.value)}}n.elem=o;var u=function(l){return function(h){return(0,n.isNone)(h)?!1:l(h.value)}};n.exists=u,n.Do=(0,n.of)(_.emptyRecord),n.bindTo=(0,b.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(_.emptyReadonlyArray);var m=function(l){return function(h){var A=l(0,_.head(h));if((0,n.isNone)(A))return n.none;for(var B=[A.value],Q=1;Q<h.length;Q++){var jt=l(Q,h[Q]);if((0,n.isNone)(jt))return n.none;B.push(jt.value)}return(0,n.some)(B)}};n.traverseReadonlyNonEmptyArrayWithIndex=m;var C=function(l){var h=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(l);return function(A){return _.isNonEmpty(A)?h(A):n.ApT}};n.traverseReadonlyArrayWithIndex=C,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var Y=function(l){return(0,n.traverseReadonlyArrayWithIndex)(function(h,A){return l(A)})};n.traverseArray=Y,n.sequenceArray=(0,n.traverseArray)(g.identity);function fn(l){return function(h){return(0,n.isSome)(l(h))}}n.getRefinement=fn,n.mapNullable=n.chainNullableK,n.option={URI:n.URI,map:O,of:n.of,ap:w,chain:f,reduce:c,foldMap:v,reduceRight:S,traverse:W,sequence:n.sequence,zero:n.zero,alt:D,extend:cn,compact:n.compact,separate:n.separate,filter:K,filterMap:x,partition:tn,partitionMap:en,wither:sn,wilt:Sn,throwError:n.throwError},n.getApplySemigroup=(0,i.getApplySemigroup)(n.Apply),n.getApplyMonoid=(0,a.getApplicativeMonoid)(n.Applicative);var yt=function(){return(0,n.getMonoid)((0,s.first)())};n.getFirstMonoid=yt;var p=function(){return(0,n.getMonoid)((0,s.last)())};n.getLastMonoid=p})(Wt);var ae={};(function(n){var t=U&&U.__createBinding||(Object.create?function(w,f,c,v){v===void 0&&(v=c);var S=Object.getOwnPropertyDescriptor(f,c);(!S||("get"in S?!f.__esModule:S.writable||S.configurable))&&(S={enumerable:!0,get:function(){return f[c]}}),Object.defineProperty(w,v,S)}:function(w,f,c,v){v===void 0&&(v=c),w[v]=f[c]}),e=U&&U.__setModuleDefault||(Object.create?function(w,f){Object.defineProperty(w,"default",{enumerable:!0,value:f})}:function(w,f){w.default=f}),r=U&&U.__importStar||function(w){if(w&&w.__esModule)return w;var f={};if(w!=null)for(var c in w)c!=="default"&&Object.prototype.hasOwnProperty.call(w,c)&&t(f,w,c);return e(f,w),f};Object.defineProperty(n,"__esModule",{value:!0}),n.getMonoid=n.getSemigroup=n.io=n.sequenceArray=n.traverseArray=n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex=n.traverseReadonlyNonEmptyArrayWithIndex=n.ApT=n.apS=n.bind=n.bindTo=n.Do=n.FromIO=n.ChainRec=n.MonadIO=n.fromIO=n.chainFirst=n.Monad=n.Chain=n.Applicative=n.apSecond=n.apFirst=n.Apply=n.Pointed=n.flap=n.Functor=n.URI=n.flatten=n.chain=n.of=n.ap=n.map=void 0;var a=on,i=J,d=un,y=X,g=Z,b=r(L),_=function(w,f){return function(){return f(w())}},M=function(w,f){return function(){return w()(f())}},s=function(w,f){return function(){return f(w())()}},I=function(w,f){return function(){for(var c=f(w)();c._tag==="Left";)c=f(c.left)();return c.right}},R=function(w){return function(f){return _(f,w)}};n.map=R;var P=function(w){return function(f){return M(f,w)}};n.ap=P,n.of=y.constant;var j=function(w){return function(f){return s(f,w)}};n.chain=j,n.flatten=(0,n.chain)(y.identity),n.URI="IO",n.Functor={URI:n.URI,map:_},n.flap=(0,g.flap)(n.Functor),n.Pointed={URI:n.URI,of:n.of},n.Apply={URI:n.URI,map:_,ap:M},n.apFirst=(0,i.apFirst)(n.Apply),n.apSecond=(0,i.apSecond)(n.Apply),n.Applicative={URI:n.URI,map:_,ap:M,of:n.of},n.Chain={URI:n.URI,map:_,ap:M,chain:s},n.Monad={URI:n.URI,map:_,ap:M,of:n.of,chain:s},n.chainFirst=(0,d.chainFirst)(n.Chain),n.fromIO=y.identity,n.MonadIO={URI:n.URI,map:_,ap:M,of:n.of,chain:s,fromIO:n.fromIO},n.ChainRec={URI:n.URI,map:_,ap:M,chain:s,chainRec:I},n.FromIO={URI:n.URI,fromIO:y.identity},n.Do=(0,n.of)(b.emptyRecord),n.bindTo=(0,g.bindTo)(n.Functor),n.bind=(0,d.bind)(n.Chain),n.apS=(0,i.apS)(n.Apply),n.ApT=(0,n.of)(b.emptyReadonlyArray);var H=function(w){return function(f){return function(){for(var c=[w(0,b.head(f))()],v=1;v<f.length;v++)c.push(w(v,f[v])());return c}}};n.traverseReadonlyNonEmptyArrayWithIndex=H;var E=function(w){var f=(0,n.traverseReadonlyNonEmptyArrayWithIndex)(w);return function(c){return b.isNonEmpty(c)?f(c):n.ApT}};n.traverseReadonlyArrayWithIndex=E,n.traverseArrayWithIndex=n.traverseReadonlyArrayWithIndex;var O=function(w){return(0,n.traverseReadonlyArrayWithIndex)(function(f,c){return w(c)})};n.traverseArray=O,n.sequenceArray=(0,n.traverseArray)(y.identity),n.io={URI:n.URI,map:_,of:n.of,ap:M,chain:s,fromIO:n.fromIO,chainRec:I},n.getSemigroup=(0,i.getApplySemigroup)(n.Apply),n.getMonoid=(0,a.getApplicativeMonoid)(n.Applicative)})(ae);const{pipe:V,flow:Li,constant:Fi,identity:Ci,tupled:Wi,constVoid:qi}=tr;Tt(Nt.Apply);Tt(Wt.Apply);Cn(Nt.Apply);Cn(Wt.Apply);Cn(ae.Apply);const F=(n,t,e)=>n+(t-n)*e,ie=(n,t)=>e=>[n(e),t(e)],Dn=(n,t)=>e=>e==null?t():n(e),ue=(n,t,e,r)=>{const a=(r[0]-e[0])*(n[1]-e[1])-(r[1]-e[1])*(n[0]-e[0]),i=(e[1]-n[1])*(n[0]-t[0])-(e[0]-n[0])*(n[1]-t[1]),d=(r[1]-e[1])*(t[0]-n[0])-(r[0]-e[0])*(t[1]-n[1]);if(d==0)return null;const y=a/d,g=i/d;return y>=0&&y<=1&&g>=0&&g<=1?{position:[F(n[0],t[0],y),F(n[1],t[1],y)],offset:y}:null},ca=(n,t)=>n.every((e,r)=>t.every((a,i)=>ue(e,n[(r+1)%n.length],a,t[(i+1)%t.length])==null));let st=100,_n=5;G.brain.subscribe(({sensorLength:n})=>{st=n});G.master.subscribe(({gridSize:n})=>{_n=n});const St=(n,t)=>{const r=[Math.floor((n[0]/200+_n)%_n),Math.floor((n[1]/200+_n)%_n)],a=(r[0]+r[1]*_n)*4,i=d=>d.map(y=>[(r[0]+y[0])*200,(r[1]+y[1])*200]);return[...t[a],...t[a+1],...t[a+2],...t[a+3]].map(i)},la=(n,t)=>[...St([n.x,n.y],t.borders),...ce(n,t)],oa=(n,t)=>[...St([n.x,n.y],t.borders),...St([n.x-Math.sin(n.angle)*st,n.y-Math.cos(n.angle)*st],t.borders),...ce(n,t)],ce=(n,t)=>t.polygons.reduce((e,r)=>[...e,...r.map((a,i)=>[a,r[(i+1)%r.length]])],[]),Tn=n=>{const t=[],e=Math.hypot(n.width,n.height)/2,r=Math.atan2(n.width,n.height);return t.push([n.x-Math.sin(-n.angle-r)*e,n.y-Math.cos(-n.angle-r)*e]),t.push([n.x-Math.sin(-n.angle+r)*e,n.y-Math.cos(-n.angle+r)*e]),t.push([n.x-Math.sin(Math.PI-n.angle-r)*e,n.y-Math.cos(Math.PI-n.angle-r)*e]),t.push([n.x-Math.sin(Math.PI-n.angle+r)*e,n.y-Math.cos(Math.PI-n.angle+r)*e]),{box:n,polygon:t}},fa=n=>t=>{const{box:e,polygon:r}=t;return!la(e,n).every(d=>ca(r,d))},qt=(n,t,e)=>({borders:t,polygons:e.filter(r=>r!==n&&ha(r.box,n.box)<=Math.max(r.box.width,r.box.height)).map(r=>Tn(r.box).polygon)}),ha=(n,t)=>Math.sqrt((n.x-t.x)**2+(n.y-t.y)**2);let le=.04,Rt=5;G.controls.subscribe(({friction:n,maxSpeed:t})=>{le=n,Rt=t});const da=n=>t=>V(n,ga(t)),ga=n=>t=>{var b,_,M,s;const e=(_=(b=n.physics)==null?void 0:b.mass)!=null?_:10,r=(s=(M=n.physics)==null?void 0:M.momentum)!=null?s:{direction:0,magnitude:0},{thrust:a,breaks:i,angle:d}=t,y=a/e,g=Math.max(Math.min(r.magnitude+y,Rt),-Rt);return n.physics={mass:e,momentum:{...r,magnitude:Math.max(Math.abs(g)-le-i,0)*(g<0?-1:1)}},n.angle=(n.angle+d*g+Math.PI*2)%(Math.PI*2),n.x+=Math.sin(n.angle)*g,n.y-=Math.cos(n.angle)*g,n},ma=n=>t=>da(t)(n),va=n=>t=>(t.x=t.x<0?n.width:t.x>n.width?0:t.x,t.y=t.y<0?n.height:t.y>n.height?0:t.y,t),Nn=2*Math.PI,ya=n=>(n.path=n.path.filter(t=>he([n.box.x,n.box.y],t)>100),n),oe=n=>{const t=n.path[0];return t?Math.atan((t[0]-n.box.x)/(t[1]-n.box.y))-(n.box.y<t[1]?Math.PI:0):0},fe=n=>Math.abs((oe(n)+n.box.angle+Nn)%Nn/Nn-.5)*4-1,he=(n,t)=>Math.sqrt((n[0]-t[0])**2+(n[1]-t[1])**2),ba=n=>he(n.destination,[n.box.x,n.box.y]),_a=n=>t=>{const[e,r]=n.destination;t.fillStyle="purple",t.beginPath(),t.arc(e,r,n.box.width/2,0,Nn),t.fill(),t.strokeStyle="purple",t.beginPath(),t.setLineDash([9,3]),t.moveTo(n.box.x,n.box.y),t.lineTo(e,r),t.stroke();const a=oe(n),i=[n.box.x,n.box.y],d=[n.box.x-Math.sin(a)*100,n.box.y-Math.cos(a)*100];return t.strokeStyle="red",t.beginPath(),t.setLineDash([9,3]),t.moveTo(...i),t.lineTo(...d),t.stroke(),t.strokeStyle="blue",t.setLineDash([9,3]),t.beginPath(),n.path.forEach((y,g)=>g===0?t.moveTo(...y):t.lineTo(...y)),t.stroke(),t};let Un=3,Mt=100,wt=Math.PI/4;Xt.update(n=>n);G.brain.subscribe(({sensorCount:n,sensorLength:t,sensorSpread:e})=>{Un=n,Mt=t,wt=e});const de=n=>t=>V(oa(t,n),e=>new Array(Un*2).fill(0).map((r,a)=>{const i=a%2*Math.PI+F(wt/2,-wt/2,Un==1?.5:Math.floor(a/2)/(Un-1))-t.angle,d=[t.x,t.y],y=[t.x-Math.sin(i)*Mt,t.y-Math.cos(i)*Mt],g=e.map(b=>ue(d,y,...b)).filter(b=>b!=null);return g.sort((b,_)=>b.offset-_.offset),{start:d,end:y,contacts:g}})),sa=(n,t,e)=>r=>V(n.box,de(qt(n,t,e)),Sa(r),_a(n)),Sa=n=>t=>t.map(e=>{var a,i;const r=(i=(a=e.contacts[0])==null?void 0:a.position)!=null?i:e.end;return n.lineWidth=2,n.strokeStyle="yellow",n.beginPath(),n.moveTo(...e.start),n.lineTo(...r),n.stroke(),n.strokeStyle="black",n.beginPath(),n.moveTo(...e.end),n.lineTo(...r),n.stroke(),n})[0];G.controls.subscribe(({cameraFocus:n})=>{});const Ra=n=>t=>t.map((e,r)=>e.dead?e:V(e.box,Tn,fa(qt(e,n.generatedMap.borders,t)),Ia(e),Aa,Oa,ya)),Ma=n=>t=>t.map(e=>({car:e,sensor:V(e.box,de(qt(e,n,t)))})),wa=n=>t=>t.map(({car:e,action:r})=>V(r,ma(e.box),va(n.size))),Ia=n=>t=>{var e,r;return t&&(n.performace-=Math.abs((r=(e=n.box.physics)==null?void 0:e.momentum.magnitude)!=null?r:0))*30,n.dead=t,n},Aa=n=>{var t,e;return n.performace+=((e=(t=n.box.physics)==null?void 0:t.momentum.magnitude)!=null?e:0)*fe(n)-1,n},Oa=n=>n;let ge=0;G.brain.subscribe(({minFitness:n})=>{ge=n});const Ea=n=>t=>n.map(e=>{const r=Tn(e.box).polygon;t.beginPath(),t.fillStyle=e.dead?"red":e.color,r.forEach((i,d)=>d==0?t.moveTo(...i):t.lineTo(...i)),t.fill();const a={...e.box,height:e.box.height*Math.max(e.fitness/ge,0)};return t.beginPath(),t.fillStyle="red",Tn(a).polygon.forEach((i,d)=>d==0?t.moveTo(...i):t.lineTo(...i)),t.fill(),t})[0],N=6,hn=16,q=5,rn="black",Rn="gray",k=[0,0],bn=[n=>t=>{n.fillStyle=Rn;const e=F(0,t.width,1/N);n.fillRect(e-q*2,0,t.width-e*2+q*4,t.height),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=[r,r];new Array(N-1).fill(0).forEach((i,d)=>{const y=F(0,t.width,(d+1)/N);n.beginPath(),n.setLineDash(d==0||d==N-2?k:a),n.moveTo(y,0),n.lineTo(y,t.height),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height),n.fillRect(0,e.y-q*2,t.width,t.height-e.y*2+q*4),n.fillStyle=rn,n.beginPath(),n.arc(e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=t.width/hn,i=[r,r],d=[a,a];new Array(N-1).fill(0).forEach((y,g)=>{let b=F(0,t.width,(g+1)/N),_=F(0,t.height,1/N);n.setLineDash(g==0||g==N-2?k:i),n.beginPath(),n.moveTo(b,0),n.lineTo(b,_),n.stroke(),n.beginPath(),n.moveTo(b,t.height-_),n.lineTo(b,t.height),n.stroke(),b=F(0,t.width,1/N),_=F(0,t.height,(g+1)/N),n.setLineDash(g==0||g==N-2?k:d),n.beginPath(),n.moveTo(0,_),n.lineTo(b,_),n.stroke(),n.beginPath(),n.moveTo(t.width-b,_),n.lineTo(t.width,_),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height),n.fillRect(0,e.y-q*2,t.width/2,t.height-e.y*2+q*4),n.fillStyle=rn,n.beginPath(),n.arc(e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=t.width/hn,i=[r,r],d=[a,a];new Array(N-1).fill(0).forEach((y,g)=>{let b=F(0,t.width,(g+1)/N),_=F(0,t.height,1/N);g==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(b,0),n.lineTo(b,t.height),n.stroke()):(n.setLineDash(g==0||g==N-2?k:i),n.beginPath(),n.moveTo(b,0),n.lineTo(b,_),n.stroke(),n.beginPath(),n.moveTo(b,t.height-_),n.lineTo(b,t.height),n.stroke()),b=F(0,t.width,1/N),_=F(0,t.height,(g+1)/N),n.setLineDash(g==0||g==N-2?k:d),n.beginPath(),n.moveTo(0,_),n.lineTo(b,_),n.stroke()})},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height-e.y),n.fillRect(0,e.y-q*2,t.width-e.x+q*2,t.height-e.y*2+q*4),n.fillStyle=rn,n.beginPath(),n.arc(e.x,e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=[r,r];new Array(N-1).fill(0).forEach((i,d)=>{let y=F(0,t.width,(d+1)/N),g=F(0,t.height,1/N);d==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(y,0),n.lineTo(y,t.height-e.y),n.stroke()):(n.setLineDash(d==0||d==N-2?k:a),n.beginPath(),n.moveTo(y,0),n.lineTo(y,g),n.stroke()),y=F(0,t.width,1/N),g=F(0,t.height,(d+1)/N),d==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(0,g),n.lineTo(t.width-e.x,g),n.stroke()):(n.setLineDash(d==0||d==N-2?k:a),n.beginPath(),n.moveTo(0,g),n.lineTo(y,g),n.stroke())})},()=>()=>{},n=>t=>{n.fillStyle=Rn;const e={x:F(0,t.width,1/N),y:F(0,t.height,1/N)};n.fillRect(e.x-q*2,0,t.width-e.x*2+q*4,t.height-e.y+q*2),n.fillStyle=rn,n.beginPath(),n.arc(e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.beginPath(),n.arc(t.width-e.x,t.height-e.y,q/2,0,2*Math.PI),n.fill(),n.lineWidth=q,n.strokeStyle=rn;const r=t.height/hn,a=[r,r];new Array(N-1).fill(0).forEach((i,d)=>{let y=F(0,t.width,(d+1)/N),g=F(0,t.height,1/N);d==0||d==N-2?(n.setLineDash(k),n.beginPath(),n.moveTo(y,0),n.lineTo(y,t.height-e.y),n.stroke()):(n.setLineDash(a),n.beginPath(),n.moveTo(y,0),n.lineTo(y,g),n.stroke()),y=F(0,t.width,1/N),g=F(0,t.height,(d+1)/N),d==N-2&&(n.setLineDash(k),n.beginPath(),n.moveTo(e.x,g),n.lineTo(t.width-e.x,g),n.stroke())})}],Pa=[()=>({rotate:0,draw:bn[4]}),n=>({rotate:n.indexOf(!0),draw:bn[5]}),n=>{const t=n[0]==n[2],e=t?n[0]?0:1:n[0]&&n[3]?0:n[1]&&n[0]?1:n[2]&&n[1]?2:3,r=t?bn[0]:bn[3];return{rotate:e,draw:r}},n=>({rotate:n[2]&&n[3]&&n[0]?0:n[3]&&n[0]&&n[1]?1:n[0]&&n[1]&&n[2]?2:3,draw:bn[2]}),()=>({rotate:0,draw:bn[1]})],T=F(0,1,1/N),Na=[[[T,T],[1-T,T]],[[1-T,T],[1-T,1-T]],[[1-T,1-T],[T,1-T]],[[T,1-T],[T,T]]],Ua=[[[[T,0],[T,T]],[[1-T,0],[1-T,T]]],[[[1,T],[1-T,T]],[[1,1-T],[1-T,1-T]]],[[[1-T,1],[1-T,1-T]],[[T,1],[T,1-T]]],[[[0,T],[T,T]],[[0,1-T],[T,1-T]]]],Ta=n=>n.map((t,e)=>t?Ua[e]:[Na[e]]),me=(n,t,e)=>(n-e+t)%t,ve=(n,t,e)=>{let r=(n+1)%t;return r=Math.abs(r%e-n%e)>1?(r-e+t)%t:r,r},ye=(n,t,e)=>(n+e)%t,be=(n,t,e)=>{let r=(n-1+t)%t;return r=Math.abs(r%e-n%e)>1?(r+e)%t:r,r},La=n=>{const t=Math.sqrt(n.map.length),e=n.map.map(a=>1/0),r=n.map.map(a=>1/0);return e[n.start]=0,r[n.start]=Se(yn(n.start,t),yn(n.end,t)),_e({...n,width:t,open:[n.start],closed:[],costs:e,guesses:r,cameFrom:n.map.map(a=>0)})},_e=n=>{const{map:t,start:e,end:r,width:a,open:i,closed:d,costs:y,guesses:g,cameFrom:b}=n,_=R=>Se(yn(R,a),yn(r,a)),M=i.map(R=>_(R)),s=M.reduce((R,P,j)=>P<M[R]?j:R,0),I=i[s];return i.splice(s,1),d.push(I),t[I].map((R,P)=>R?Fa[P](I,t.length,a):null).filter(R=>R!=null).filter(R=>!d.includes(R)).forEach(R=>{const j=y[I]+1;j<y[R]&&(b[R]=I,y[R]=j,g[R]=j+_(R),i.includes(R)||i.push(R))}),i.length===0?[]:I===r?se(b,I,e):_e(n)},se=(n,t,e,r=[t])=>t===e?r:se(n,n[t],e,[n[t],...r]),yn=(n,t)=>[n%t,Math.floor(n/t)],Se=(n,t)=>Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1]),Fa=[me,ve,ye,be],Ca=n=>({connections:Ln[0].slice(),possibilities:new Array(Ln.length).fill(0).map((t,e)=>e),index:n}),Ln=[[!1,!1,!1,!1],[!0,!0,!0,!0],[!0,!1,!0,!1],[!1,!0,!1,!0],[!0,!0,!1,!1],[!1,!1,!0,!0],[!0,!0,!0,!1],[!0,!0,!1,!0],[!0,!1,!0,!0],[!1,!0,!0,!0]],Wa=[me,ve,ye,be],qa=(n,t,e)=>{const r=Ln[e.possibilities[Math.floor(Math.random()*e.possibilities.length)]];r.forEach((a,i)=>V(Wa[i](e.index,t.length,n),d=>{const y=(i+2)%4;t[d].connections[y]=a,t[d].possibilities=t[d].possibilities.filter(g=>Ln[g][y]===a)})),e.connections=r,e.possibilities=[]},Da=n=>new Array(n**2).fill(null).map((t,e)=>Ca(e)),ja=(n,t)=>n.possibilities.length-t.possibilities.length,Re=n=>t=>{if(t.filter(a=>a.possibilities.length!=0).length==0)return t.map(a=>a.connections);const e=t.slice().sort(ja).filter(a=>a.possibilities.length!=0),r=e.filter(a=>a.possibilities.length==e[0].possibilities.length);return qa(n,t,r[Math.floor(Math.random()*r.length)]),Re(n)(t)},Ka=n=>n.map(t=>Pa[t.reduce((e,r)=>e+Number(r),0)](t)),pa=n=>V(Da(n),Re(n),t=>({connections:t,map:Ka(t),borders:t.reduce((e,r)=>[...e,...Ta(r)],[])}));let Me=100,we=-400;G.master.subscribe(n=>{const t=n.gridSize*200;Me=Math.sqrt(t**2+t**2)});G.brain.subscribe(({minFitness:n})=>{we=n});const Ba=n=>n.map(t=>V(t,Ie,$a(t.brain))),Ie=n=>n.performace+ba(n)/Me*we,Va=n=>Ie(n),$a=n=>t=>({...n,reward:t}),Ja=n=>(n.sort((t,e)=>e.reward-t.reward),n[0]);let It=0,Ae=600,Oe=!1;G.controls.subscribe(({cameraFocus:n,playerControls:t})=>{Oe=t,It=n});G.brain.subscribe(({minFitness:n})=>{Ae=n});const Ga=n=>{var e,r;n.map(a=>Ya(a));const t=(r=(e=n.slice().map((a,i)=>({car:a,i})).filter(a=>!a.car.dead).sort((a,i)=>i.car.fitness-a.car.fitness)[0])==null?void 0:e.i)!=null?r:0;return!Oe&&It!=null&&It!=t&&G.controls.update(a=>({...a,cameraFocus:t})),n.filter(a=>!a.dead)},Ya=n=>n.dead?null:Ha(n)<Ae?n.dead=!0:null,Ha=n=>n.fitness=Va(n),Di={onkeydown:n=>{n.preventDefault(),Fn[n.key]=Qa[n.key]||ka},onkeyup:n=>{n.preventDefault(),delete Fn[n.key]}},Xa=()=>{const n={...Za};return Object.keys(Fn).map(t=>Fn[t](n)),n},Za={thrust:0,breaks:0,angle:0};let At=3,Ot=.1,Et=.5*Math.PI/180;G.controls.subscribe(({carThrust:n,carTurnSpeed:t,carBreakStrength:e})=>{At=n,Ot=e,Et=t*Math.PI/180});const Fn={},Qa={ArrowUp:n=>n.thrust=At,ArrowDown:n=>n.thrust=At*-.4,ArrowLeft:n=>n.angle=-Et,ArrowRight:n=>n.angle=Et,Shift:n=>n.breaks=Ot,Space:n=>n.breaks=Ot},ka=n=>{};let Ee,Pe;ke.subscribe(n=>{Ee=n});Xt.subscribe(n=>{Pe=n});const Ne=(n,t)=>{const e=document.getElementById(n)||pt("error: declaring canvas returned null",Ee);e.width=t.width,e.height=t.height;const r=e.getContext("2d")||pt("error: declaring context returned null",Pe);return{canvas:e,ctx:r}},pt=(n,t)=>(console.error(n),t);let _t;const za="background-canvas",xa=n=>t=>n.backgroundSaved?(t.drawImage(_t,0,0),t):(_t=V(Ne(za,n.size),ni(n)),t.drawImage(_t,0,0),n.backgroundSaved=!0,t),ni=n=>t=>{const{canvas:e,ctx:r}=t,{generatedMap:a,size:i,dim:d}=n;r.fillStyle="green",r.fillRect(0,0,i.width,i.height);const y={width:i.width/d,height:i.height/d};return new Array(a.map.length).fill(0).map((g,b)=>{r.save(),r.translate(F(0,i.width,b%d/d)+y.width/2,F(0,i.height,Math.floor(b/d)/d)+y.height/2),r.rotate(a.map[b].rotate*90*Math.PI/180),r.translate(-y.width/2,-y.height/2),a.map[b].draw(r)(y),r.restore()}),e},ti=[[-1,-1],[0,1],[1,0],[0,-1],[-1,0],[1,-1],[-1,1],[1,1]],ji=(n,t,e,r)=>ei(n,ti.filter(a=>!0),e);let Ue=!1,Te=0;G.controls.subscribe(({drawSensors:n,cameraFocus:t})=>{Te=t,Ue=n});const ei=(n,t,e)=>{const r=a=>V(a,xa(n),Ea(e),Ue?sa(e[Te],n.generatedMap.borders,e):i=>i);return a=>(t.forEach(i=>{a.save(),a.translate(n.size.width*i[0],n.size.height*i[1]),r(a),a.restore()}),r(a))},ri=n=>t=>(t.clearRect(0,0,n.width,n.height),t);let Mn;const ai="network-canvas",Bt="transparent",ii="grey",Vt="black",$t="white";let Le;const Ki=(n,t)=>e=>{if(!n)return e;const r={width:e.canvas.width/2.5,height:e.canvas.height/2.5};return Mn=Mn!=null?Mn:Ne(ai,r).ctx,V(Mn,ri(r),ui(Le,t)),e},ui=(n,t)=>e=>{if(!n)return;const r=50,a=r,i=r,d=e.canvas.width-r*2,y=e.canvas.height-r*2,g=2;e.lineDashOffset=-t/50,e.lineWidth=g*2,e.fillStyle=Vt,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.strokeStyle=Vt,e.strokeRect(g,g,e.canvas.width-g*2,e.canvas.height-g*2),e.strokeStyle=ii,e.strokeRect(g*3,g*3,e.canvas.width-g*6,e.canvas.height-g*6);const b=y/n.length;for(let _=n.length-1;_>=0;_--){const M=i+F(y-b,0,n.length==1?.5:_/(n.length-1));e.setLineDash([7,3]),ci(e,n[_],a,M,d,b,_==n.length-1?["T","L","Ri","B","Re"]:[])}return e},ci=(n,t,e,r,a,i,d)=>{const y=e+a,g=r+i,{inputs:b,outputs:_,weights:M,biases:s}=t;for(let R=0;R<b.length;R++)for(let P=0;P<_.length;P++)n.beginPath(),n.moveTo(On(b,R,e,y),g),n.lineTo(On(_,P,e,y),r),n.lineWidth=2,n.strokeStyle=En(M[R][P]),n.stroke();const I=18;for(let R=0;R<b.length;R++){const P=On(b,R,e,y);n.beginPath(),n.arc(P,g,I*.85,0,Math.PI*2),n.fillStyle=Bt,n.fill(),n.beginPath(),n.arc(P,g,I*.6,0,Math.PI*2),n.fillStyle=En(b[R]),n.fill()}for(let R=0;R<_.length;R++){const P=On(_,R,e,y);n.beginPath(),n.arc(P,r,I*.85,0,Math.PI*2),n.fillStyle=Bt,n.fill(),n.beginPath(),n.arc(P,r,I*.6,0,Math.PI*2),n.fillStyle=En(_[R]),n.fill(),n.beginPath(),n.lineWidth=2,n.arc(P,r,I*1,0,Math.PI*2),n.strokeStyle=En(s[R]),n.setLineDash([3,3]),n.stroke(),n.setLineDash([]),d[R]&&(n.beginPath(),n.textAlign="center",n.textBaseline="middle",n.fillStyle=$t,n.strokeStyle=$t,n.font=I*.9+"px Arial",n.fillText(d[R],P,r+I*.1),n.lineWidth=.5,n.strokeText(d[R],P,r+I*.1))}},On=(n,t,e,r)=>F(e,r,n.length==1?.5:t/(n.length-1)),En=n=>{const t=Math.abs(n),e=255,r=0,a=n>0?255:0;return`rgba(${e},${a},${r},${t})`},li=n=>Le=n;let Fe=0,Ce=3,We=.1,Pt=.5*Math.PI/180,qe=!1;G.controls.subscribe(n=>{Fe=n.cameraFocus,qe=n.playerControls,Ce=n.carThrust,We=n.carBreakStrength,Pt=n.carTurnSpeed*Math.PI/180});const oi=n=>qe?n.map(({car:t})=>({car:t,action:Xa()})):n.map(({car:t,sensor:e},r)=>fi(t,e,r)),fi=(n,t,e)=>{const[r,a,i,d,y]=V([fe(n),...t.map(g=>{var b,_;return 1-((_=(b=g.contacts[0])==null?void 0:b.offset)!=null?_:1)})],ie(g=>e===Fe?V(g,Ze(n.brain),li):null,Xe(n.brain)))[1];return{car:n,action:{thrust:Ce*r*(y>.5?-.4:1),angle:Pt*-a+Pt*i,breaks:We*d}}},Dt="bestNetwork";let jn=!1;Pn.subscribe(n=>jn=n);const hi=n=>{if(!jn)return!1;try{localStorage.setItem(Dt,JSON.stringify(n))}catch{return!1}return!0},di=()=>{if(!jn)return!1;try{localStorage.removeItem(Dt)}catch{return!1}return!0},gi=()=>{if(!jn)return null;try{return localStorage.getItem(Dt)}catch{return null}},mi=n=>hi(n),vi=n=>!0,De=()=>{var n;return JSON.parse((n=gi())!=null?n:"null")},yi=De,je=()=>V(De(),Dn(n=>n,yi)),bi=di,_i=n=>{const t=je();return Zt.update(e=>({...e,curReward:n.reward,bestReward:t==null?void 0:t.reward})),t==null||t.reward<n.reward?n:null},si=(n,t=.3)=>({layers:Si(n.layers,t)}),Si=(n,t)=>n.map(e=>V(e,Ri(t),Mi(t))),Ri=n=>t=>(t.biases=t.biases.map(e=>F(e,Math.random()*2-1,n)),t),Mi=n=>t=>(t.weights=t.weights.map(e=>e.map(r=>F(r,Math.random()*2-1,n))),t),{simulation:wi,master:Ke}=G,mn=200,Jt=mn/N*.6,Gt=["#0f0","#000","#0ff","#f0f","#fff"];let dn=gn.master,nn=gn.simulation;Ke.subscribe(n=>dn=n);wi.subscribe(n=>nn=n);const Ii=(n,t,e)=>{const r=Number(dn.gridSize),a=n.connections.map((P,j)=>({connection:P,tile:j})).filter(P=>P.connection.includes(!0)),i=Math.floor(Math.random()*a.length),d=a[i].tile,y=a.map(P=>({...P,path:La({map:n.connections,start:d,end:P.tile})})).reduce((P,j)=>P.path.length>j.path.length?P:j),g=y.tile,b=y.path.map(P=>yn(P,r).map(j=>j*200+100)),[_,M]=yn(d,r),s=yn(g,r).map(P=>P*200+100),I=(y.path[1]+r+1)%n.connections.length-(y.path[0]+r+1)%n.connections.length,R=I===1?Math.PI/2:I===r?Math.PI:I===-r?0:3*Math.PI/2;return{brain:V(e,Dn(si,()=>Yt([t*2+1,...nn.layers]))),box:{x:_*mn+F(0,mn,(Math.floor(1+Math.random()*(N-2))+.5)/N),y:M*mn+F(0,mn,(Math.floor(1+Math.random()*(N-2))+.5)/N),width:Jt,height:Jt*1.6,angle:R,physics:{momentum:{direction:0,magnitude:0},mass:Math.random()*5+5}},destination:s,color:Gt[Math.floor(Math.random()*Gt.length)],dead:!1,fitness:0,performace:0,path:b}},Ai=(n,t)=>{var y,g;const r=pa(Number(dn.gridSize)),a=(y=t==null?void 0:t.world)!=null?y:{generatedMap:r,dim:dn.gridSize,size:{width:dn.gridSize*mn,height:dn.gridSize*mn},backgroundSaved:!1},i=V(je(),Dn(b=>n.sensorCount===b.layers[0].inputs.length?b:null,()=>null)),d=(g=t==null?void 0:t.carSpots)!=null?g:new Array(dn.carAmount).fill(gn.simulation.carSpots[0]).map(()=>Ii(r,n.sensorCount,i));return{world:a,carSpots:d,currentId:null}},Oi=()=>requestAnimationFrame(pe),Ei=n=>nn.destroyed||nn.currentId!=n,pe=(n,t=n,e=Math.random())=>{if(nn.currentId==null&&(nn.currentId=e),!Ei(e)){if(Ni()){Pi();return}Zt.update(r=>({...r,fps:Math.round(1/((n-t)/1e3))})),requestAnimationFrame(r=>pe(r,n,e))}},Pi=()=>V(nn.carSpots,Ba,Ja,_i,Dn(ie(mi,vi),()=>[!0]),n=>n.every(t=>t)?requestAnimationFrame(()=>Ke.update(t=>({...t}))):alert("error! could not save to each storage")),Ni=()=>V(nn.carSpots,Ra(nn.world),Ga,Ma(nn.world.generatedMap.borders),oi,wa(nn.world)).every(n=>n==null);function Ui(n,t,e){let r,a,i,d;In(n,Pn,s=>e(4,r=s));let{input:y}=t;const{master:g,simulation:b,brain:_,controls:M}=G;return In(n,g,s=>e(5,a=s)),In(n,b,s=>e(7,d=s)),In(n,_,s=>e(6,i=s)),Je(()=>{An(Pn,r=!0,r),An(b,d.destroyed=!1,d)}),Ge(()=>{An(b,d.destroyed=!0,d),An(Pn,r=!1,r)}),n.$$set=s=>{"input"in s&&e(3,y=s.input)},n.$$.update=()=>{n.$$.dirty&104&&G.simulation.update(s=>({...s,...Ai(i,y)})),n.$$.dirty&64&&bi(),n.$$.dirty&48&&r&&Oi()},[g,b,_,y,r,a,i]}class pi extends Be{constructor(t){super(),Ve(this,t,Ui,null,$e,{input:3})}}export{Di as C,pi as E,ke as a,Xt as b,G as c,ri as d,ji as e,ze as f,da as g,Zt as l,V as p,Ki as r};
